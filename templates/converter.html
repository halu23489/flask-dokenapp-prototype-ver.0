{% extends "layout.html" %}
{% set page_title = 'HEIC to JPG 変換' %}

{% block content %}
<div class="d-flex align-items-center mb-4">
    <div class="app-icon metal-steel me-3" style="width:72px;height:72px;border-radius:12px;">
        <i class="bi bi-camera-fill" style="font-size:1.6rem; color:inherit;"></i>
    </div>
    <div>
        <h2 class="mb-0">HEIC to JPG 変換</h2>
        <small class="text-muted">EXIFを保持したままJPGへ変換します</small>
    </div>
</div>

<div class="container">
    <p class="lead">iPhoneなどで撮影したHEIC形式の画像を、EXIF（メタデータ）を維持したまま汎用的なJPG形式に変換します。</p>

    <!-- Flashメッセージの表示エリア -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">HEICファイルアップロード</h5>
        </div>
        <div class="card-body">
            <!-- フォームのアクションが 'convert_file' を指していることを確認 -->
            <form method="POST" action="{{ url_for('convert_file') }}" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="heicFile" class="form-label">HEICファイルを選択:</label>
                    <!-- multiple 属性を追加して複数選択を可能に -->
                    <input class="form-control" type="file" id="heicFile" name="heic_file" accept=".heic, .heif" required multiple>
                    <div class="form-text">
                        複数のファイルを選択できます (CtrlキーまたはShiftキーを押しながら選択)。
                        変換後、ファイルは <strong class="text-danger">Converted_HEIC_Files.zip</strong> という名前のZipファイルとしてダウンロードされます。
                    </div>
                </div>
                <!-- ライブラリが利用できない場合はボタンを無効化 -->
                {% if HEIF_AVAILABLE %}
                    <button type="submit" class="btn btn-success">変換してZipをダウンロード</button>
                {% else %}
                    <button type="submit" class="btn btn-danger" disabled>HEICライブラリがありません</button>
                    <p class="text-danger mt-2">サーバー側でHEIC変換ライブラリが利用できないため、この機能は無効になっています。</p>
                {% endif %}
            </form>
        </div>
    </div>
</div>
{% endblock %}